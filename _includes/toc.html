{% comment %}
  Table of Contents and Word Count
  Generates a collapsible table of contents from page headings
  and displays the word count
{% endcomment %}

<aside class="sidebar__right">
  <nav class="toc">
    <header>
      <h4 class="nav__title"><i class="fas fa-{{ include.icon | default: 'file-alt' }}"></i> {{ include.title | default: site.data.ui-text[site.locale].toc_label | default: "On This Page" }}</h4>
      <p class="page__meta"><i class="fas fa-file-word"></i> <span id="word-count"></span> words</p>
    </header>
    <details id="toc-details">
      <summary>Table of Contents</summary>
      <ul class="toc__menu" id="markdown-toc">
        <!-- TOC will be generated here by JavaScript -->
      </ul>
    </details>
  </nav>
</aside>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Word count
  const content = document.querySelector('.page__content');
  if (content) {
    const text = content.innerText || content.textContent;
    const wordCount = text.trim().split(/\s+/).length;
    document.getElementById('word-count').textContent = wordCount.toLocaleString();
  }
  
  // Generate table of contents
  const tocContainer = document.getElementById('markdown-toc');
  const headings = document.querySelectorAll('.page__content h2, .page__content h3, .page__content h4');
  
  if (headings.length > 0 && tocContainer) {
    headings.forEach(function(heading, index) {
      // Create ID if doesn't exist
      if (!heading.id) {
        heading.id = 'heading-' + index;
      }
      
      // Create TOC entry
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = heading.textContent;
      
      // Add class based on heading level
      if (heading.tagName === 'H2') {
        li.className = 'toc-h2';
      } else if (heading.tagName === 'H3') {
        li.className = 'toc-h3';
      } else if (heading.tagName === 'H4') {
        li.className = 'toc-h4';
      }
      
      li.appendChild(a);
      tocContainer.appendChild(li);
    });
    
    // Smooth scrolling for TOC links
    const tocLinks = tocContainer.querySelectorAll('a');
    tocLinks.forEach(function(link) {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  } else {
    // Hide TOC if no headings
    const tocDetails = document.getElementById('toc-details');
    if (tocDetails) {
      tocDetails.style.display = 'none';
    }
  }
});
</script>